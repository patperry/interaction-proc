\documentclass[aoas,preprint]{imsart}
\pdfoutput=1    % Make arXiv happy

\RequirePackage[OT1]{fontenc}
\RequirePackage{amsthm,amsmath,amssymb}
\RequirePackage[colorlinks,citecolor=blue,urlcolor=blue]{hyperref}
\RequirePackage{hypernat}
\RequirePackage{graphicx}

\setattribute{journal}{name}{}  % Suppress text "Submitted to..."

\startlocaldefs
\usepackage{iproc-macros}
\endlocaldefs


\begin{document}

\begin{frontmatter}

\title{
    A model for repeated interactions with applications to email traffic
    analysis\protect\thanksref{T1}
}

\runtitle{A point process model for graphs}
\thankstext{T1}{Supported by grant\ldots}

\begin{aug}
    \author{%
        \fnms{Patrick O.} \snm{Perry}\corref{}%
        \ead[label=e1]{patperry@seas.harvard.edu}%
    }%
    \and%
    \author{%
        \fnms{Patrick J.} \snm{Wolfe}%
        \ead[label=e2]{wolfe@stat.harvard.edu}%
    }%

    \runauthor{P.\ O.\ Perry and P.\ J.\ Wolfe}

    \affiliation{Harvard University}

    \address{
        Statistics and Information Sciences Laboratory \\
        Harvard University \\
        33 Oxford Street \\
        Cambridge, MA 02138 \\
        \printead{e1}\\
        \phantom{E-mail:\ }\printead*{e2}
    }
\end{aug}

\begin{abstract}
Abstract.
\end{abstract}

\begin{keyword}[class=AMS]
    \kwd[Primary ]{62M30}     % Statistics:Inference from stochastic processes:Spatial processes
    \kwd[; secondary ]{62N01} % Statistics:Survival analysis and censored data:Censored data models
\end{keyword}

\begin{keyword}
    \kwd{random graphs}
    \kwd{networks}
    \kwd{point processes}
    \kwd{inference}
\end{keyword}

\end{frontmatter}


\section{Introduction}

Data derived from observing repeated pairwise interactions are becoming more
and more common. One obvious source are communications networks: either all of
the phone calls made or the emails sent between inviduals in a small
community. More broadly, one can consider the notion of ``pairwise
interaction'' to include

\begin{description}

    \item[migration patterns] where each ``individual'' is a greographical
    location, and each ``interaction'' is a family relocating (rehabituating)
    from one county to another;

    \item[collaborations] where individuals are authors and interactions are
    the works they coauthor; alternatively, individuals are congressmen and
    interactions are coauthored bills; or

    \item[text analysis] where individials are works or bigrams, and
    interactions are co-occurrences in phrases or documents.

\end{description}

For the current treatment, we shall consider directed interactions, with each
interaction having an initiator (sender) and at least one recipient
(receiver). To simplify the development, initially we focus on the
single-recipient case, so that each interaction involves a single
sender-receiver pair. If we consider the first author of a work to be the
initiator, and if we respect word order in a document, then all of the above
interaction scenarios can be included. Mostly, though, we will focus on
communication networks.

Suppose we observe a system of individuals interacting over time. At the end
of the observation period, we have witnessed a stream of interaction events of
the form $(t, i, j)$. This triple denotes that at time $t$, we observed the
interaction $i \to j$, an interaction sent by individual $i$ and received by
individual $j$. We take $[0,T]$ to be the observation time period,
$\mathcal{I} = \{1, \ldots, I \}$ to be the set of senders, and $\mathcal{J} =
\{1, \ldots, J \}$ to be the set of receivers. Oftentimes $\mathcal{I} =
\mathcal{J}$, but not always.

Given covariate information about the senders and receivers, we want to
determine which characteristics and behaviors are associated with (predictive
of) interaction. We want to answer the following questions.

\begin{enumerate}

    \item If two individuals share an attribute, are they more likely to
    interact? In studying human behavior, Sociologists have repeatedly found
    evidence of homophily, the tendency of individuals to associate with
    similar others \cite{mcpherson2001birds}. We would like to know, for
    example, if pairs of people with the same gender interact more often then
    pairs of people with differing genders.

    \item If individual $i$ sends a message to individual $j$, is $j$ likely
    to respond? How much more likely does the interaction $j \to i$ become,
    and how does this depend on time? When I send you a message at 12:00~p.m.\
    on Monday, I certainly do not expect a reply before 12:01~p.m., but I
    might expect one before 12:00~p.m.\ on Tuesday. Maybe I should expect a
    reply before 1:00~p.m. Certainly, if I have not heard from you in two
    weeks, I should not expect a reply the next month. How can statements like
    this be made precise, and how can they be derived from data?

    \item Conversely, if individual $i$ interacts with $j$ at time $t$, is he
    more likely to interact with $j$ at time $t+1$? How much more likely, and
    how does this affect decay over time?

\end{enumerate}

We present a simple modeling framework to facilitate inquiry into all of the
above. The framework is flexible enough to allow various forms of
time-inhomogeneity and dependency, and includes the ability to handle
interactions with multiple recipients. However, we stress that without further
justification, none of our conclusions imply causality---they only show
association.


\section{The Enron Email Data}

Our motivating dataset is a large collection of email messages sent within the
Enron corporation during the last four years of the company's existence. The
Enron email corpus is a large subset of the email messages sent within the
corporation between November 1998 and June 2002. Enron was an energy company
based in Texas that became notorious in late 2001 for its fraudulent
accounting practices. These practices eventually lead to the resignation of
its CEO, to an external audit into its accounting procedures, to massive
readjustments to its earnings statements, and eventually to its bankruptcy.
Later, many of the top executives were prosecuted and convicted of criminal
fraud and insider trading. As part of the investigation, the Federal Energy
Regulatory Commission (FERC) subpoenaed the e-mail correspondences of the top
employees and posted those not related to the criminal trial to their website
(619,446 messages, roughly 92\% of those subpoenaed).

Leslie Kaelbling, a computer scientist at MIT, purchased the corpus from the
FERC with the intention of making it available to the research community. A
team of researchers at SRI International worked to fix a number of apparent
integrity problems with the data, and then it was released to the public by
William Cohen, at CMU. This is the ``March 2, 2004 Version'' of the dataset.
Later, a former Enron employee requested that one message be removed from the
data; this removal prompted the ``August 21, 2009 Version,'' widely regarded
to be the authoritative version \cite{cohen2009enron}.

Zhou et al. have gone through substantial work to preprocess the Enron corpus
into a useful form \cite{zhou2007strategies}. We rely on their preprocessed
version for our analysis. They reduce the data to the set of e-mails sent by
high-ranking Enron executives, eliminating messages sent by non-employees,
support staff and administrative assistants. They also filter out messages
with missing timestamps. After this culling process, there are 21,635 messages
sent by 156 employees between November 13, 1998 and June 21, 2002. Each email
message has a message body consisting of text, along with header fields
including \texttt{Date}, \texttt{From}, \texttt{To}, \texttt{CC},
\texttt{BCC}, and \texttt{Subject}. The \texttt{From} field always lists a
unique e-mail address, but the \texttt{To}, \texttt{CC}, and \texttt{BCC}
fields sometimes specify multiple recipients. We make no distinction between
\texttt{To}, \texttt{CC}, and \texttt{BCC}, combining them all to determine
the recipients of a message.

We can associate a set of static covariates for each of the 156 individuals in
the dataset. Zhou et al. have extracted the employees' names, departments, and
titles. We use the forenames of the employees to associate genders to the
employees (e.g, John is male, Susan is female). For ambiguously-gendered names
like Dana, Robin, and Sean, we use personal pronouns in the messages to help
code the genders. We code the department as one of three categories: Legal,
Trading, or Other. Finally, we code the position as Senior (CEO, CFO, COO,
Director, Managing Director, VP, President) or Junior (Administrator, Analyst,
Assistant, Attorney, Counsel, Employee, Manager, Specialist, Trader).


\section{Contingency Tables}

The contingency table is an established method for analyzing homophily and
group-level behavior.

\section{Pitfalls of Table-Based Analyses}

The table-based analysis does not account for variability in individual
behavior, ignores the times of the messages, and does not handle messages with
multiple recipients.

\subsection{Individual Inhomogeneity}
\subsection{Time Dependence}
\subsection{Multiple Recipients}


\section{A Point Process Model}

Here we introduce a more flexible modeling framework that includes
time-inhomogeneity and dependence.  Initially, we focus on the
single-recipient setting.

For each pair of actors, $(i,j) \in \mathcal{I} \times \mathcal{J}$, and each
time interval, $(s,t] \subset \reals_+$, let $N_{ij}\big((s,t]\big)$ denote the
number of $i \to j$ interactions in $(s,t]$.


This can be interpreted as a counting measure on
$\reals_+$, with $N_{ij}\big((s,t]\big)$ defined as the
number of $i \to j$ interactions in the time interval $(s,t]$, so that
$N_{ij}\big((s,t]\big) = N_{ij}(t) - N_{ij}(s)$. The collection
$N = \{ N_{ij} \}_{(i,j) \in \mathcal{I} \times \mathcal{J}}$ encodes the
interaction process.

Suppose that actors are under observation for time in the interval $[0,T]$. As
before, $\mathcal{I}$ is the set of senders and $\mathcal{J}$ is the set of
receivers. The data comes to us in the form of a list of interactions: $(T_1,
I_1, J_1), \ldots, (T_n, I_n, j_n),$ with tuple $(t_l, i_l, j_l)$ denoting
that interaction $i_l \to j_l$ happened at time $t_l$.  Encode the data as
$N$, a Borel measure on $[0,T] \times \mathcal{I} \times \mathcal{J}$ given
by
\[
    N_{ij}(t) = \sum_{l=1}^{n} \delta_{(t_l, i_l, j_l)}.
\]
Here and elsewhere, $\delta$ is the Dirac delta measure.  Encode the messages
sent from sender $i$ as 
$\xi_i(t, j) = \sum_{l=1}^N 1\{t_l \leq t, i_l = i, j_l = j\}$ and set
$\xi_i(t) = \sum_{j \in \mathcal{J}} \xi_i(t,j)$.  Note that
$\xi(t, i, j) = \xi_i(t, j)$.

We introduce a probability space $(\Omega, \mathcal{F}, \mathbb{P})$ on which
$\xi$ is defined, together with a filtration of $\mathcal{F},$ given as
$\big\{ \mathcal{F}_t : t \in [0, T] \big\}$. Take $\xi$ to be adapted to $\{
\mathcal{F}_t \}$, that is, take $\xi(t, i, j)$ to be
$\mathcal{F}_t$-measurable. For simplicity, assume that no more than one
interaction can take place at a given time (the times $t_1, \ldots, t_N$ are
unique \textit{a.s.}). Under certain conditions, there exists a collection of
non-negative predictable random processes $\lambda = \{ \lambda_{i,j} : (i,j)
\in \mathcal{I} \times \mathcal{J} \}$, such that for fixed $i$ and $j$,
\[
    \xi(t, i, j) - \int_{0}^{t} \lambda_{i,j}(t) \, dt
\]
is a martingale.  The collection of processes, $\lambda$, is termed the
\emph{stochastic intensity} of $\xi$; in our setting it contains all of the
``signal'' information in $\xi$.


\clearpage


Suppose $[0,T]$ is the observation
interval.  We will need a probability space
 together with a filtration of
$\mathcal{F}$, given by


Suppose we observe interactions  We
can represent these interactions by a marked point process indexed by time,
with marks in $\mathcal{I} \times \mathcal{J}$. Alternatively, we can consider
$I$ different point processes, each corresponding the the interactions sent by
a particular individual $i \in \mathcal{I}$, with marks in $\mathcal{J}$. For
sender $i \in \mathcal{I}$ we let $\xi_i$ be the point process of interactions
sent by $i$. Formally, $\xi_i$ is an integer-valued Borel measure on $[0,T]
\times \mathcal{J}$. If $(t_{1,i}, i, j_{1,i}), \ldots, (t_{N_i, i}, i,
j_{N_i,i})$ are the interactions sent by $i$, then
\[
    \xi_i = \sum_{l=1}^{N_i} \delta_{(t_{l,i}, j_{l,i})},
\]
where $\delta$ is the Dirac delta.  Similarly, we let $\xi$ be the point
process of all interactions:
\[
    \xi = \sum_{l=1}^{N} \delta_{(t_l, i_l, j_l)},
\]
so that
\[
    \xi(t, i, j) = \xi_i(t, j).
\]

Our model is that the times of the interactions sent by $i$ come from an inhomogeneous Poisson process with intensity $\lambda_i(\cdot)$.  Thus,
for $A \subset [0,T]$, the number of interactions sent by $i$ for time
in $A$ is a Poisson random variable with mean $\int_A \lambda_i(t) \, dt$.
Note that this random variable is equivalent to
\(
    \xi_i(A \times \mathcal{J}).
\)
The Poisson process assumption also implies that if $B$ is another subset 
of $[0,T]$ with $A \cap B = \emptyset$, then
\(
    \xi_i(A \times \mathcal{J})
\)
and
\(
    \xi_i(B \times \mathcal{J})
\)
are independent.

We take $\mathcal{F}_t$ to be the sigma algebra generated by the
random variables $\xi(A, i, j)$ for $A \subset [0,t]$ an open set.

We next describe the distribution of the marks (receivers). We suppose that
conditionally on the existence of an interaction sent by $i$ at time $t$, the
receiver, $j$ is chosen from a multinomial distribution on $\mathcal{J}$ with
probabilities $\pi_{j | i}(t)$. Formally, we will require that $\pi_{j |
i}(t)$ be predictable (measurable with respect to $\mathcal{F}_{t^-}$).

Suppose at time $t$ we have covariates for each pair of sender $i$ and
receiver $j$, denoted $x_{i,j}(t) \in \reals^K$. For example $x_{i,j}(t)$ can
have a covariate indicating if $i$ and $j$ share the same gender. Also,
$x_{i,j}(t)$ can have a covariate indicating if an interaction $i \to j$ has
occurred in the week preceding time $t$. The first case is an example of a
static covariate (one that does not change with time), and the second case is
an example of a dynamic covariate. Our only restriction on $x_{i,j}(\cdot)$ is
that it be predictable.

Introduce receiver effects $\beta_1, \ldots, \beta_J$.  Effect $\beta_j$ is
a measure of the ``popularity'' of receiver $j$.  Also, let $\theta \in \reals^K$ be a fixed vector of coefficients.  We choose the probabilities so that $\log \pi_{j|i}(t)$ is proportional to $\beta_j + \langle x_{ij}(t), \theta \rangle$.  Since $\sum_{j=1}^{J} \pi_{j|i}(t) = 1$, we must have
\[
    \log \pi_{j|i}(t)
    = \alpha_i(t) + \beta_j + \langle x_{ij}(t), \theta \rangle
\]
where
\[
    \alpha_i(t)
    = -\log\Big[
        \sum_{j=1}^J \exp\{\beta_j +  \langle x_{ij}(t), \theta \rangle\}
    \Big].
\]
We could have included the receiver effects in $x_{i,j}(t)$, but it is more
natural to treat them separately.



\bibliographystyle{imsart-number}
\bibliography{iproc-sources}

\end{document}
